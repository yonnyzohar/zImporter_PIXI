/*! zimporter-pixi v1.0.50 | (c) 2025 Yonathan Zohar */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("PIXI"),require("PIXI.particles"),require("PIXI.filters"),require("PIXI.spine")):"function"==typeof define&&define.amd?define(["PIXI","PIXI.particles","PIXI.filters","PIXI.spine"],e):"object"==typeof exports?exports.zimporter=e(require("PIXI"),require("PIXI.particles"),require("PIXI.filters"),require("PIXI.spine")):t.zimporter=e(t.PIXI,t["PIXI.particles"],t["PIXI.filters"],t["PIXI.spine"])}(this,((t,e,i,s)=>(()=>{"use strict";var n={105:t=>{t.exports=i},381:t=>{t.exports=s},836:e=>{e.exports=t},865:t=>{t.exports=e}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return n[t](i,i.exports,o),i.exports}o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};o.r(a),o.d(a,{ZButton:()=>p,ZContainer:()=>u,ZCuePointsManager:()=>b,ZNineSlice:()=>d,ZResizeables:()=>g,ZScene:()=>P,ZSceneStack:()=>A,ZScroll:()=>S,ZSlider:()=>y,ZSpine:()=>L,ZState:()=>v,ZTextInput:()=>C,ZTimeline:()=>f,ZToggle:()=>x,ZUpdatables:()=>m});var h=o(836),l=o(865);class d extends h.NineSlicePlane{constructor(t,e,i){super(t,e.left,e.right,e.top,e.bottom),this.portrait=e.portrait,this.landscape=e.landscape,this.currentTransform="portrait"===i?this.portrait:this.landscape,this.applyTransform()}resize(t,e,i){this.currentTransform="portrait"===i?this.portrait:this.landscape,this.applyTransform()}applyTransform(){this.width=this.currentTransform.width,this.height=this.currentTransform.height}}class u extends h.Container{constructor(){super(...arguments),this.resizeable=!0,this.name="",this._fitToScreen=!1}get(t){const e=[];if(this.children&&this.children.length>0)for(let t of this.children)t instanceof u&&e.push(t);for(;e.length>0;){const i=e.shift();if(i.name===t)return i;if(i.children&&i.children.length>0)for(let t of i.children)t instanceof u&&e.push(t)}return null}getAll(t){const e=[],i=[];if(this.children&&this.children.length>0)for(let t of this.children)t instanceof u&&e.push(t);for(;e.length>0;){const s=e.shift();if(s.name===t&&i.push(s),s.children&&s.children.length>0)for(let t of s.children)t instanceof u&&e.push(t)}return i}init(){}getType(){return"ZContainer"}getAllOfType(t){const e=[],i=[];if(this.children&&this.children.length>0)for(let t of this.children)t.getType&&e.push(t);for(;e.length>0;){const s=e.shift();if(s.getType()===t&&i.push(s),s.children&&s.children.length>0)for(let t of s.children)t.getType&&e.push(t)}return i}setText(t){var e;let i=this.getTextField();if(i){i.text=t;let s=i.style;if(s&&(s.fontSize=null!==(e=this.originalFontSize)&&void 0!==e?e:s.fontSize,i.style=s,this.fixedBoxSize)){let t=this.originalTextWidth;if(void 0!==t&&t>0)for(;i.width>t;)s=new h.TextStyle(Object.assign(Object.assign({},s),{fontSize:s.fontSize-1})),i.style=s}}}getTextField(){let t=null;if(t=this.getChildByName("label"),!t){let e=this.children;for(let i=0;i<e.length;i++){let s=e[i];if(s instanceof h.Text){t=s;break}}}return t}setInstanceData(t,e){this.portrait=t.portrait,this.landscape=t.landscape,this.currentTransform="portrait"===e?this.portrait:this.landscape,this.applyTransform(),this.name=t.instanceName||"",t.attrs&&void 0!==t.attrs.fitToScreen&&(this.fitToScreen=t.attrs.fitToScreen)}set fitToScreen(t){this._fitToScreen=t,t?this.executeFitToScreen():this.applyTransform()}get fitToScreen(){return this._fitToScreen}applyTransform(){if(this._fitToScreen)this.executeFitToScreen();else if(this.currentTransform&&this.resizeable){if(this.parent){let t=this.parent.currentFrame;if(void 0!==t&&t>0)return}this.x=this.currentTransform.x||0,this.y=this.currentTransform.y||0,this.rotation=this.currentTransform.rotation||0,this.alpha=this.currentTransform.alpha,this.scale.x=this.currentTransform.scaleX||1,this.scale.y=this.currentTransform.scaleY||1,this.pivot.x=this.currentTransform.pivotX||0,this.pivot.y=this.currentTransform.pivotY||0,this.applyAnchor()}}resize(t,e,i){this.currentTransform="portrait"===i?this.portrait:this.landscape,this.applyTransform()}executeFitToScreen(){let t=this.children;if(0!==t.length&&this.parent){this.pivotX=0,this.pivotY=0;let e=this.parent.toLocal(new h.Point(0,0));if(this.x=e.x,this.y=e.y,t[0]instanceof d){let i=t[0],s=this.parent.toLocal(new h.Point(window.innerWidth,window.innerHeight));i.width=s.x-e.x,i.height=s.y-e.y}else{if(window.innerWidth>window.innerHeight){let t=this.parent.toLocal(new h.Point(window.innerWidth,0));this.width=t.x-e.x,this.scaleY=this.scaleX}else{let t=this.parent.toLocal(new h.Point(0,window.innerHeight));this.height=t.y-e.y,this.scaleX=this.scaleY}let t=this.parent.toLocal(new h.Point(window.innerWidth/2,window.innerHeight/2));this.x=t.x-this.width/2,this.y=t.y-this.height/2}}}applyAnchor(){if(this.currentTransform&&this.currentTransform.isAnchored&&this.parent){let t=this.currentTransform.anchorPercentage.x||0,e=this.currentTransform.anchorPercentage.y||0,i=t*window.innerWidth,s=e*window.innerHeight;const n=new h.Point(i,s),r=this.parent.toLocal(n);this.x=r.x,this.y=r.y}}isAnchored(){return this.currentTransform&&this.currentTransform.isAnchored||!1}set x(t){super.x=t,this.currentTransform&&(this.currentTransform.x=t)}set width(t){super.width=t,this.currentTransform&&(this.currentTransform.scaleX=this.scale.x)}get width(){return super.width}get height(){return super.height}set height(t){super.height=t,this.currentTransform&&(this.currentTransform.scaleY=this.scale.y)}set y(t){super.y=t,this.currentTransform&&(this.currentTransform.y=t)}set rotation(t){super.rotation=t,this.currentTransform&&(this.currentTransform.rotation=t)}get x(){return super.x}get y(){return super.y}get rotation(){return super.rotation}get scaleX(){return super.scale.x}get scaleY(){return super.scale.y}get pivotX(){return super.pivot.x}get pivotY(){return super.pivot.y}set scaleX(t){super.scale.x=t,this.currentTransform&&(this.currentTransform.scaleX=t)}set scaleY(t){super.scale.y=t,this.currentTransform&&(this.currentTransform.scaleY=t)}set pivotX(t){super.pivot.x=t,this.currentTransform&&(this.currentTransform.pivotX=t)}set pivotY(t){super.pivot.y=t,this.currentTransform&&(this.currentTransform.pivotY=t)}loadParticle(t,e,i){try{t.behaviors.find((t=>"textureSingle"===t.type)).config=Object.assign(Object.assign({},t.behaviors.find((t=>"textureSingle"===t.type)).config),{texture:e}),this.emitter=new l.Emitter(this,t),this.playParticleAnim()}catch(t){console.error("Error creating ParticleController:",t),alert("Failed to load particle effect. Please make sure you're using the new Pixi JSON format (with 'behaviors'). Legacy configs with 'alpha', 'scale', 'speed', etc. are no longer supported in the latest version of the particle system."),console.warn("⚠️ Particle config may be in legacy format.\nNew versions of @pixi/particle-emitter require 'behaviors' instead of 'alpha', 'speed', etc.\nConvert your old config or use pixi-particles@4 if you must keep the old format.\n\nDocs: https://github.com/pixijs/particle-emitter#emitterconfig")}}playParticleAnim(){this.emitter?this.emitter.emit=!0:console.warn("Emitter not initialized. Call loadParticle first.")}stopParticleAnim(){this.emitter?this.emitter.emit=!1:console.warn("Emitter not initialized. Call loadParticle first.")}}const c=(t,e,i)=>{t.interactive=!0,t.interactiveChildren=!0,e&&(t.pressCallback=e),i&&(t.longPressCallback=i);let s=null;let n=!1,r=null;const o=t=>t.data&&t.data.global?{x:t.data.global.x,y:t.data.global.y}:t.global?{x:t.global.x,y:t.global.y}:null,a=e=>{n=!1,r=o(e),s=setTimeout((()=>{n=!0,t.longPressCallback&&t.longPressCallback()}),500),t.on("mouseup",h),t.on("touchend",h),t.on("touchendoutside",h),t.on("mouseupoutside",h)},h=e=>{clearTimeout(s),s=null;let i=!1;const a=o(e);if(r&&a){const t=a.x-r.x,e=a.y-r.y;Math.sqrt(t*t+e*e)>20&&(i=!0)}r=null,n||i||t.pressCallback&&t.pressCallback(),t.off("mouseup",h),t.off("touchend",h),t.off("touchendoutside",h),t.off("mouseupoutside",h)};t.on("mousedown",a),t.on("touchstart",a)};class p extends u{constructor(){super(...arguments),this.labelState="none"}getType(){return"ZButton"}init(t=""){var e,i,s,n,r,o,a,h;super.init(),this.interactive=!0,this.interactiveChildren=!0,this.overState&&(this.overLabelContainer=null===(e=this.overState)||void 0===e?void 0:e.getChildByName("labelContainer"),this.overLabelContainer2=null===(i=this.overState)||void 0===i?void 0:i.getChildByName("labelContainer2")),this.disabledState&&(this.disabledLabelContainer=null===(s=this.disabledState)||void 0===s?void 0:s.getChildByName("labelContainer"),this.disabledLabelContainer2=null===(n=this.disabledState)||void 0===n?void 0:n.getChildByName("labelContainer2")),this.downState&&(this.downLabelContainer=null===(r=this.downState)||void 0===r?void 0:r.getChildByName("labelContainer"),this.downLabelContainer2=null===(o=this.downState)||void 0===o?void 0:o.getChildByName("labelContainer2")),this.upState&&(this.upLabelContainer=null===(a=this.upState)||void 0===a?void 0:a.getChildByName("labelContainer"),this.upLabelContainer2=null===(h=this.upState)||void 0===h?void 0:h.getChildByName("labelContainer2")),this.topLabelContainer=this.labelContainer,this.topLabelContainer2=this.labelContainer2,this.topLabelContainer?(this.labelState="single",this.upState.parent.addChild(this.upState),this.topLabelContainer.parent.addChild(this.topLabelContainer)):this.overState&&this.disabledState&&this.downState&&this.upState&&this.overLabelContainer&&this.disabledLabelContainer&&this.downLabelContainer&&this.upLabelContainer&&(this.labelState="multi",this.upState.parent.addChild(this.upState),this.upLabelContainer&&this.upState.addChild(this.upLabelContainer),this.upLabelContainer2&&this.upState.addChild(this.upLabelContainer2)),this.enable()}setLabel(t){"single"===this.labelState&&this.topLabelContainer?(this.topLabelContainer.visible=!0,this.topLabelContainer.setText(t),this.topLabelContainer.parent.addChild(this.topLabelContainer)):"multi"===this.labelState&&(this.overLabelContainer&&(this.overLabelContainer.visible=!0,this.overLabelContainer.setText(t)),this.disabledLabelContainer&&(this.disabledLabelContainer.visible=!0,this.disabledLabelContainer.setText(t)),this.downLabelContainer&&(this.downLabelContainer.visible=!0,this.downLabelContainer.setText(t)),this.upLabelContainer&&(this.upLabelContainer.visible=!0,this.upLabelContainer.setText(t)))}setLabel2(t){"single"===this.labelState&&this.topLabelContainer2?(this.topLabelContainer2.visible=!0,this.topLabelContainer2.setText(t)):"multi"===this.labelState&&(this.overLabelContainer2&&(this.overLabelContainer2.visible=!0,this.overLabelContainer2.setText(t)),this.disabledLabelContainer2&&(this.disabledLabelContainer2.visible=!0,this.disabledLabelContainer2.setText(t)),this.downLabelContainer2&&(this.downLabelContainer2.visible=!0,this.downLabelContainer2.setText(t)),this.upLabelContainer2&&(this.upLabelContainer2.visible=!0,this.upLabelContainer2.setText(t)))}setFixedTextSize(t){[this.topLabelContainer,this.topLabelContainer2,this.overLabelContainer,this.overLabelContainer2,this.disabledLabelContainer,this.disabledLabelContainer2,this.downLabelContainer,this.downLabelContainer2,this.upLabelContainer,this.upLabelContainer2].filter(Boolean).forEach((e=>{e.setFixedBoxSize&&e.setFixedBoxSize(t)}))}setCallback(t){this.callback=t,c(this,(()=>this.onClicked()),this.longPressCallback)}removeCallback(){var t;this.callback=void 0,(t=this).removeAllListeners("mouseup"),t.removeAllListeners("touchend"),t.removeAllListeners("touchendoutside"),t.removeAllListeners("mouseupoutside"),t.removeAllListeners("mousedown"),t.removeAllListeners("touchstart")}setLongPressCallback(t){this.longPressCallback=t,c(this,this.callback?()=>this.onClicked():void 0,t)}removeLongPressCallback(){this.longPressCallback=void 0,c(this,this.callback?()=>this.onClicked():void 0,void 0)}onClicked(){this.callback&&this.callback()}enable(){this.cursor="pointer",[this.upState,this.overState,this.downState].forEach((t=>t&&(t.cursor="pointer"))),this.removeAllListeners();let t=this.overState,e=this.downState,i=this.upState,s=this.disabledState,n=this.topLabelContainer,r=this.topLabelContainer2,o=this.labelState;const a=()=>this.onOut(),h=()=>this.onOver(),l=()=>this.onDown();t&&i&&(t.visible=!1,this.on("mouseout",a),this.on("mouseover",h),this.on("touchendoutside",a),this.on("touchend",a),this.on("touchendoutside",a),t.visible=!1),e&&i&&(this.on("mousedown",l),this.on("touchstart",l),this.on("mouseup",a),this.on("touchendoutside",a),this.on("touchend",a),this.on("touchendoutside",a),e.visible=!1),s&&(s.visible=!1),i&&(i.visible=!0,this.addChild(i)),"single"===o&&n&&(this.addChild(n),n.alpha=1,r&&(this.addChild(r),r.alpha=1)),this.onOut(),c(this,this.callback?()=>this.onClicked():void 0,this.longPressCallback)}disable(){this.cursor="default",this.interactive=!1,[this.upState,this.overState,this.downState].forEach((t=>t&&(t.cursor="default"))),this.removeAllListeners(),this.disabledState&&(this.disabledState.visible=!0,this.addChild(this.disabledState)),this.topLabelContainer&&(this.addChild(this.topLabelContainer),this.topLabelContainer.alpha=.5),this.topLabelContainer2&&(this.addChild(this.topLabelContainer2),this.topLabelContainer2.alpha=.5)}onDown(){this.overState&&(this.overState.visible=!1),this.disabledState&&(this.disabledState.visible=!1),this.upState&&this.downState&&(this.upState.visible=!1),this.downState&&(this.downState.visible=!0,this.addChild(this.downState)),this.topLabelContainer&&(this.addChild(this.topLabelContainer),this.topLabelContainer.alpha=.5,this.topLabelContainer2&&(this.addChild(this.topLabelContainer2),this.topLabelContainer2.alpha=.5))}onOut(){this.overState&&(this.overState.visible=!1),this.upState&&(this.upState.visible=!0,this.addChild(this.upState)),this.topLabelContainer&&(this.addChild(this.topLabelContainer),this.topLabelContainer.alpha=1,this.topLabelContainer2&&(this.addChild(this.topLabelContainer2),this.topLabelContainer2.alpha=1))}onOver(){this.overState&&(this.overState.visible=!0,this.addChild(this.overState)),this.topLabelContainer&&(this.addChild(this.topLabelContainer),this.topLabelContainer.alpha=1,this.topLabelContainer2&&(this.addChild(this.topLabelContainer2),this.topLabelContainer2.alpha=1))}}class g{static addResizeable(t){g.resizeables.set(t,!0)}static resize(){for(const[t]of g.resizeables)t.resize()}static removeResizeable(t){g.resizeables.delete(t)}}g.resizeables=new Map;var _=o(105);class b{static addCuePointListener(t,e){var i;this.cuePoints.has(t)||this.cuePoints.set(t,[]),null===(i=this.cuePoints.get(t))||void 0===i||i.push(e)}static removeCuePointListener(t,e){if(this.cuePoints.has(t)){const i=this.cuePoints.get(t);if(i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}}static triggerCuePoint(t,...e){if(this.cuePoints.has(t)){const i=this.cuePoints.get(t);if(i)for(const t of i)t(...e)}}}b.cuePoints=new Map;class m{static init(t){this.fpsInterval=1e3/t,this.then=Date.now(),this.startTime=this.then}static addUpdateAble(t){m.updatables.set(t,!0)}static update(){if(this.now=Date.now(),this.elapsed=this.now-this.then,this.elapsed>this.fpsInterval){this.then=this.now-this.elapsed%this.fpsInterval;for(const[t]of m.updatables)t.update()}}static removeUpdateAble(t){m.updatables.delete(t)}}m.updatables=new Map,m.fpsInterval=0,m.then=0,m.now=0,m.elapsed=0,m.startTime=0;class f extends u{constructor(){super(),this.currentFrame=0,this.looping=!0,this.cuePoints={},this.totalFrames,this._frames,this.currentFrame=0,this.looping=!0}setCuePoints(t){this.cuePoints=t}getFrames(){return this._frames}setFrames(t){this._frames=t;let e=0;if(null!=this._frames){for(const t in this._frames)this._frames[t]instanceof Array&&this._frames[t].length>e&&(e=this._frames[t].length);this.totalFrames=e}}removeStateEndEventListener(){this.func=void 0}addStateEndEventListener(t){this.func=t}play(){m.addUpdateAble(this);for(let t=0;t<this.children.length;t++){const e=this.children[t];e instanceof f&&e.play()}}stop(){m.removeUpdateAble(this);for(let t=0;t<this.children.length;t++){const e=this.children[t];e instanceof f&&e.stop()}}gotoAndPlay(t){this.currentFrame=t,m.removeUpdateAble(this),this.play()}update(){this.gotoAndStop(this.currentFrame),this.cuePoints&&void 0!==this.cuePoints[this.currentFrame]&&b.triggerCuePoint(this.cuePoints[this.currentFrame],this),this.currentFrame++,this.currentFrame>this.totalFrames&&(this.looping?this.currentFrame=0:m.removeUpdateAble(this),this.func&&this.func.call(this,this))}gotoAndStop(t){if(this.currentFrame=t,null!=this._frames)for(const t in this._frames)if(this._frames[t][this.currentFrame]){const e=this._frames[t][this.currentFrame];this[t]&&(null!=e.pivotX&&(this[t].pivot.x=e.pivotX),null!=e.pivotY&&(this[t].pivot.y=e.pivotY),null!=e.scaleX&&(this[t].scale.x=e.scaleX),null!=e.scaleY&&(this[t].scale.y=e.scaleY),null!=e.x&&(this[t].x=e.x),null!=e.y&&(this[t].y=e.y),null!=e.alpha&&(this[t].alpha=e.alpha),null!=e.rotation&&(this[t].rotation=e.rotation))}}}class v extends u{constructor(){super(...arguments),this.currentState=null}init(){this.setState("idle")}getCurrentState(){return this.currentState}getType(){return"ZState"}hasState(t){return null!==this.getChildByName(t)}getAllStateNames(){return this.children.map((t=>t.name))}setState(t){let e=this.getChildByName(t);e||(e=this.getChildByName("idle"),e||(e=this.getChildAt(0)));for(let t=0;t<this.children.length;t++){let e=this.children[t];if(e.visible=!1,e instanceof f){e.stop()}}if(e&&(e.visible=!0,e instanceof f)){e.play()}return this.currentState=e,e.parent.addChild(e),e}}class x extends v{init(){this.cursor="pointer",c(this,(()=>{this.setState("offState"===this.currentState.name?"onState":"offState"),this.callback&&this.callback("onState"===this.currentState.name)})),this.setState("offState")}setCallback(t){this.callback=t}removeCallback(){this.callback=void 0}getType(){return"ZToggle"}}class y extends u{constructor(){super(...arguments),this.dragging=!1,this.sliderWidth=0}init(){super.init();const t=this.get("handle"),e=this.get("track");t&&e?(this.sliderWidth=e.width,this.onDragStartBinded=this.onDragStart.bind(this),this.onDragEndBinded=this.onDragEnd.bind(this),this.onDragBinded=this.onDrag.bind(this),t.on("pointerdown",this.onDragStartBinded).on("touchstart",this.onDragStartBinded).cursor="pointer"):console.error("ZSlider is missing handle or track")}getType(){return"ZSlider"}setHandlePosition(t){this.handle.x=t*this.sliderWidth,this.callback&&this.callback(t)}setCallback(t){this.callback=t}removeCallback(){this.callback=void 0}onDragStart(t){this.dragging=!0;let e=this.handle;e.on("pointermove",this.onDragBinded),e.on("pointerup",this.onDragEndBinded),e.on("pointerupoutside",this.onDragEndBinded),e.on("touchend",this.onDragEndBinded),e.on("touchendoutside",this.onDragEndBinded),e.on("touchmove",this.onDragBinded),window.addEventListener("pointerup",this.onDragEndBinded),window.addEventListener("touchend",this.onDragEndBinded)}onDragEnd(t){this.dragging=!1;let e=this.handle;e.off("pointermove",this.onDragBinded),e.off("pointerup",this.onDragEndBinded),e.off("pointerupoutside",this.onDragEndBinded),e.off("touchend",this.onDragEndBinded),e.off("touchendoutside",this.onDragEndBinded),e.off("touchmove",this.onDragBinded),window.removeEventListener("pointerup",this.onDragEndBinded),window.removeEventListener("touchend",this.onDragEndBinded)}onDrag(t){var e;const i=null===(e=t.data)||void 0===e?void 0:e.global;if(!i)return;const s=this.toLocal(i);let n=this.handle;n.x=s.x,n.x<0&&(n.x=0),n.x>this.sliderWidth&&(n.x=this.sliderWidth);const r=n.x/this.sliderWidth;this.callback&&this.callback(r),t.stopPropagation()}}class S extends u{constructor(){super(...arguments),this.scrollBarHeight=0,this.contentHeight=0,this.dragStartY=0,this.beedStartY=0,this.isDragging=!1,this.isBeedDragging=!1,this.msk=null,this.scrollArea=null}init(){super.init(),this.onPointerDownBinded=this.onPointerDown.bind(this),this.onPointerMoveBinded=this.onPointerMove.bind(this),this.onPointerUpBinded=this.onPointerUp.bind(this),this.onBeedDownBinded=this.onBeedDown.bind(this),this.onBeedUpBinded=this.onBeedUp.bind(this),this.onWheelBinded=this.onWheel.bind(this),this.beed=this.getChildByName("beed"),this.scrollBar=this.getChildByName("scrollBar"),this.scrollContent=this.getChildByName("scrollContent"),this.beed&&this.scrollBar&&this.scrollContent?this.calculateScrollBar():console.warn("ZScroll requires 'beed', 'scrollBar', and 'scrollContent' children.")}getType(){return"ZScroll"}calculateScrollBar(){if(!this.scrollBar||!this.scrollContent)return;let t=this.scrollBar.height;if(this.scrollContent.height<=t)return console.log("Content fits, no scroll needed."),this.scrollBar.visible=!1,void(this.scrollContent.y=0);this.scrollBar.visible=!0;let e=this.scrollBar.x-this.scrollContent.x;console.log("Calculated scroll width:",e),this.msk&&(this.msk.removeAllListeners(),this.msk.removeFromParent(),this.msk=null),this.msk=new h.Graphics,this.msk.name="mask",this.msk.beginFill(0,1),this.msk.drawRect(0,0,e,t),this.msk.endFill(),this.scrollContent.mask=this.msk,this.addChild(this.msk),console.log("Mask dimensions:",e,t),this.scrollArea&&(this.scrollArea.removeAllListeners(),this.scrollArea.removeFromParent(),this.scrollArea=null),this.scrollArea=new h.Graphics,this.scrollArea.name="scrollArea",this.scrollArea.beginFill(0,.001),this.scrollArea.drawRect(0,0,e,t),this.scrollArea.endFill(),this.addChildAt(this.scrollArea,0),this.scrollArea.interactive=!0,this.scrollContent.y=0,this.scrollBar.y=0,this.addEventListeners(),this.enableChildPassThrough()}enableChildPassThrough(){let t=this.scrollContent,e=this.scrollArea,i=["ZToggle","ZButton"];for(let s of i){let i=t.getAllOfType(s);for(let t=0;t<i.length;t++){let s=i[t];s.on("pointerdown",(t=>{e.emit("pointerdown",t)})),s.on("ontouchstart",(t=>{e.emit("ontouchstart",t)})),s.on("pointerup",(t=>{e.emit("pointerup",t)})),s.on("ontouchend",(t=>{e.emit("ontouchend",t)})),s.on("pointerupoutside",(t=>{e.emit("pointerupoutside",t)})),s.on("ontouchendoutside",(t=>{e.emit("ontouchendoutside",t)})),s.on("pointermove",(t=>{e.emit("pointermove",t)})),s.on("ontouchmove",(t=>{e.emit("ontouchmove",t)}))}}}addEventListeners(){this.removeEventListeners(),this.scrollArea&&(this.scrollArea.on("pointerdown",this.onPointerDownBinded),this.scrollArea.on("pointermove",this.onPointerMoveBinded),this.scrollArea.on("pointerup",this.onPointerUpBinded),this.scrollArea.on("pointerupoutside",this.onPointerUpBinded),this.scrollArea.on("touchstart",this.onPointerDownBinded),this.scrollArea.on("touchmove",this.onPointerMoveBinded),this.scrollArea.on("touchend",this.onPointerUpBinded),this.scrollArea.on("touchendoutside",this.onPointerUpBinded)),this.beed.interactive=!0,this.beed.on("pointerdown",this.onBeedDownBinded),this.beed.on("pointermove",this.onPointerMoveBinded),this.beed.on("pointerup",this.onBeedUpBinded),this.beed.on("pointerupoutside",this.onBeedUpBinded),this.beed.on("touchstart",this.onBeedDownBinded),this.beed.on("touchmove",this.onPointerMoveBinded),this.beed.on("touchend",this.onBeedUpBinded),this.beed.on("touchendoutside",this.onBeedUpBinded),document.body.addEventListener("wheel",this.onWheelBinded)}removeEventListeners(){var t,e;null===(t=this.scrollArea)||void 0===t||t.removeAllListeners(),null===(e=this.beed)||void 0===e||e.removeAllListeners(),document.body.removeEventListener("wheel",this.onWheelBinded)}onPointerDown(t){this.isDragging=!0,this.scrollBarHeight=this.scrollBar.height,this.dragStartY=t.data.global.y,this.beedStartY=this.beed.y}onBeedDown(t){this.isBeedDragging=!0,this.scrollBarHeight=this.scrollBar.height,this.dragStartY=t.data.global.y,this.beedStartY=this.beed.y}onPointerMove(t){if(this.isDragging||this.isBeedDragging){const e=t.data.global.y;let i=this.isDragging?this.dragStartY-e:e-this.dragStartY;this.beed.y=this.beedStartY+i,this.beed.y<0&&(this.beed.y=0),this.beed.y>this.scrollBarHeight-this.beed.height&&(this.beed.y=this.scrollBarHeight-this.beed.height);const s=this.beed.y/(this.scrollBarHeight-this.beed.height);this.scrollContent.y=-s*(this.scrollContent.height-this.scrollBarHeight),t.stopPropagation()}}onPointerUp(){this.isDragging=!1}onBeedUp(){this.isBeedDragging=!1}onWheel(t){let e=.5*-t.deltaY;this.scrollBarHeight=this.scrollBar.height,this.beed.y-=e,this.beed.y<0&&(this.beed.y=0),this.beed.y>this.scrollBarHeight-this.beed.height&&(this.beed.y=this.scrollBarHeight-this.beed.height);const i=this.beed.y/(this.scrollBarHeight-this.beed.height);this.scrollContent.y=-i*(this.scrollContent.height-this.scrollBarHeight),t.stopPropagation()}applyTransform(){super.applyTransform(),this.calculateScrollBar()}}class w extends h.Container{constructor(t){super(),this._dom_added=!1,this._dom_visible=!0,this._placeholder="",this._placeholderColor=11119017,this._selection=[0,0],this._restrict_value="",this._substituted=!1,this._disabled=!1,this.force=!1,this._input_style=Object.assign({position:"absolute",background:"none",border:"none",outline:"none",transformOrigin:"0 0",lineHeight:"1"},t.input),t.box?this._box_generator="function"==typeof t.box?t.box:function(t){if(t=t||{fill:13421772},t.default)t.focused=t.focused||t.default,t.disabled=t.disabled||t.default;else{const e=t;(t={}).default=t.focused=t.disabled=e}return function(e,i,s){const n=t[s.toLowerCase()],r=new h.Graphics;return n.fill&&r.beginFill(n.fill),n.stroke&&r.lineStyle(n.stroke.width||1,n.stroke.color||0,n.stroke.alpha||1),n.rounded?r.drawRoundedRect(0,0,e,i,n.rounded):r.drawRect(0,0,e,i),r.endFill(),r.closePath(),r}}(t.box):this._box_generator=null,this._input_style.hasOwnProperty("multiline")?(this._multiline=!!this._input_style.multiline,delete this._input_style.multiline):this._multiline=!1,this._box_cache={},this._previous={},this._dom_added=!1,this._dom_visible=!0,this._placeholder="",this._placeholderColor=11119017,this._selection=[0,0],this._restrict_value="",this._createDOMInput(),this.substituteText=!0,this._setState("DEFAULT"),this._addListeners(),this.styles=t}setState(t){this._setState(t)}updateBox(t,e){if(!this.styles.box||"function"==typeof this.styles.box)return;this.styles.box[e.toLowerCase()]=t;const i=this._getDOMInputBounds();this._box_generator&&(this._box_cache[e]=this._box_generator(i.width,i.height,e),this.force=!0)}get substituteText(){return this._substituted}set substituteText(t){this._substituted!==t&&(this._substituted=t,t?(this._createSurrogate(),this._dom_visible=!1):(this._destroySurrogate(),this._dom_visible=!0),this.placeholder=this._placeholder,this._update())}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=t,this._substituted?(this._updateSurrogate(),this._dom_input.placeholder=""):this._dom_input.placeholder=t}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this._dom_input.disabled=t,this._setState(t?"DISABLED":"DEFAULT")}get maxLength(){return this._max_length}set maxLength(t){this._max_length=t,void 0!==t?this._dom_input.setAttribute("maxlength",String(t)):this._dom_input.removeAttribute("maxlength")}get restrict(){return this._restrict_regex}set restrict(t){if(t instanceof RegExp){let e=t.toString().slice(1,-1);"^"!==e.charAt(0)&&(e="^"+e),"$"!==e.charAt(e.length-1)&&(e+="$"),this._restrict_regex=new RegExp(e)}else this._restrict_regex="string"==typeof t?new RegExp("^["+t+"]*$"):void 0}get text(){return this._dom_input.value}set text(t){this._dom_input.value=t,this._substituted&&this._updateSurrogate()}get htmlInput(){return this._dom_input}focus(){this._substituted&&!this._dom_visible&&this._setDOMInputVisible(!0),this._dom_input.focus()}blur(){this._dom_input.blur()}select(){this.focus(),this._dom_input.select()}setInputStyle(t,e){this._input_style[t]=e,this._dom_input.style[t]=e,!this._substituted||"fontFamily"!==t&&"fontSize"!==t&&"fontWeight"!==t&&"color"!==t||this._updateFontMetrics(),this._last_renderer&&this._update()}destroy(t){this._destroyBoxCache(),super.destroy(t)}_createDOMInput(){if(this._multiline){const t=document.createElement("textarea");t.style.resize="none",this._dom_input=t}else{const t=document.createElement("input");t.type="text",this._dom_input=t}for(const t in this._input_style)this._dom_input.style[t]=this._input_style[t]}_addListeners(){this.on("added",this._onAdded.bind(this)),this.on("removed",this._onRemoved.bind(this)),this._dom_input.addEventListener("keydown",this._onInputKeyDown.bind(this)),this._dom_input.addEventListener("input",this._onInputInput.bind(this)),this._dom_input.addEventListener("keyup",this._onInputKeyUp.bind(this)),this._dom_input.addEventListener("focus",this._onFocused.bind(this)),this._dom_input.addEventListener("blur",this._onBlurred.bind(this))}_onInputKeyDown(t){this._selection=[this._dom_input.selectionStart,this._dom_input.selectionEnd],this.emit("keydown",t.keyCode)}_onInputInput(t){this._restrict_regex&&this._applyRestriction(),this._substituted&&this._updateSubstitution(),this.emit("input",this.text)}_onInputKeyUp(t){this.emit("keyup",t.keyCode)}_onFocused(){this._setState("FOCUSED"),this.emit("focus")}_onBlurred(){this._setState("DEFAULT"),this.emit("blur")}_onAdded(){document.body.appendChild(this._dom_input),this._dom_input.style.display="none",this._dom_added=!0}_onRemoved(){document.body.removeChild(this._dom_input),this._dom_added=!1}_setState(t){this.state=t,this._updateBox(),this._substituted&&this._updateSubstitution()}getState(){return this.state}renderWebGL(t){super.renderWebGL(t),this._renderInternal(t)}renderCanvas(t){super.renderCanvas(t),this._renderInternal(t)}render(t){super.render(t),this._renderInternal(t)}_renderInternal(t){this._resolution=t.resolution,this._last_renderer=t,this._canvas_bounds=this._getCanvasBounds(),(this._needsUpdate()||this.force)&&this._update()}_update(){this._updateDOMInput(),this._substituted&&this._updateSurrogate(),this._updateBox()}_updateBox(){this._box_generator&&((this._needsNewBoxCache()||this.force)&&this._buildBoxCache(),(this.force||this.state!==this._previous.state||this._box!==this._box_cache[this.state])&&(this._box&&this.removeChild(this._box),this._box=this._box_cache[this.state],this._box&&this.addChildAt(this._box,0),this._previous.state=this.state,this.force=!1))}_updateSubstitution(){"FOCUSED"===this.state?(this._dom_visible=!0,this._surrogate&&(this._surrogate.visible=0===this.text.length)):(this._dom_visible=!1,this._surrogate&&(this._surrogate.visible=!0)),this._updateDOMInput(),this._updateSurrogate()}_updateDOMInput(){this._canvas_bounds&&(this._dom_input.style.top=(this._canvas_bounds.top||0)+"px",this._dom_input.style.left=(this._canvas_bounds.left||0)+"px",this._dom_input.style.transform=this._pixiMatrixToCSS(this._getDOMRelativeWorldTransform()),this._dom_input.style.opacity=String(this.worldAlpha),this._setDOMInputVisible(this.worldVisible&&this._dom_visible),this._previous.canvas_bounds=this._canvas_bounds,this._previous.world_transform=this.worldTransform.clone(),this._previous.world_alpha=this.worldAlpha,this._previous.world_visible=this.worldVisible)}_applyRestriction(){var t,e;this._restrict_regex&&(this._restrict_regex.test(this.text)?this._restrict_value=this.text:(this.text=this._restrict_value,this._dom_input.setSelectionRange(null!==(t=this._selection[0])&&void 0!==t?t:0,null!==(e=this._selection[1])&&void 0!==e?e:0)))}_needsUpdate(){return!this._comparePixiMatrices(this.worldTransform,this._previous.world_transform)||!this._compareClientRects(this._canvas_bounds,this._previous.canvas_bounds)||this.worldAlpha!=this._previous.world_alpha||this.worldVisible!=this._previous.world_visible}_needsNewBoxCache(){const t=this._getDOMInputBounds();return!this._previous.input_bounds||t.width!=this._previous.input_bounds.width||t.height!=this._previous.input_bounds.height}_createSurrogate(){this._surrogate_hitbox=new h.Graphics,this._surrogate_hitbox.alpha=0,this._surrogate_hitbox.interactive=!0,this._surrogate_hitbox.cursor="text",this._surrogate_hitbox.on("pointerdown",this._onSurrogateFocus.bind(this)),this.addChild(this._surrogate_hitbox),this._surrogate_mask=new h.Graphics,this.addChild(this._surrogate_mask),this._surrogate=new h.Text("",{}),this._surrogate.resolution=2,this.addChild(this._surrogate),this._surrogate&&(this._surrogate.mask=this._surrogate_mask),this._updateFontMetrics(),this._updateSurrogate()}_updateSurrogate(){const t=this._deriveSurrogatePadding(),e=this._getDOMInputBounds();if(this._surrogate){switch(this._surrogate.style=this._deriveSurrogateStyle(),this._surrogate.style.padding=Math.max(...t),this._surrogate.y=this._multiline?t[0]:(e.height-this._surrogate.height)/2,this._surrogate.x=t[3],this._surrogate.text=this._deriveSurrogateText(),this._surrogate.style.align){case"left":this._surrogate.x=t[3];break;case"center":this._surrogate.x=.5*e.width-.5*this._surrogate.width;break;case"right":this._surrogate.x=e.width-t[1]-this._surrogate.width}this._updateSurrogateHitbox(e),this._updateSurrogateMask(e,t)}}_updateSurrogateHitbox(t){this._surrogate_hitbox&&(this._surrogate_hitbox.clear(),this._surrogate_hitbox.beginFill(0),this._surrogate_hitbox.drawRect(0,0,t.width,t.height),this._surrogate_hitbox.endFill(),this._surrogate_hitbox.interactive=!this._disabled)}_updateSurrogateMask(t,e){this._surrogate_mask&&(this._surrogate_mask.clear(),this._surrogate_mask.beginFill(0),this._surrogate_mask.drawRect(e[3],0,t.width-e[3]-e[1],t.height),this._surrogate_mask.endFill())}_destroySurrogate(){var t,e;this._surrogate&&(this._surrogate&&this.removeChild(this._surrogate),this._surrogate_mask&&this.removeChild(this._surrogate_mask),this._surrogate_hitbox&&this.removeChild(this._surrogate_hitbox),null===(t=this._surrogate)||void 0===t||t.destroy(),null===(e=this._surrogate_hitbox)||void 0===e||e.destroy(),this._surrogate=null,this._surrogate_hitbox=null)}_onSurrogateFocus(){this._setDOMInputVisible(!0),setTimeout(this._ensureFocus.bind(this),10)}_ensureFocus(){this._hasFocus()||this.focus()}_deriveSurrogateStyle(){const t=new h.TextStyle;for(const e in this._input_style)switch(e){case"color":t.fill=this._input_style.color;break;case"fontFamily":case"fontSize":case"fontWeight":case"fontVariant":case"fontStyle":t[e]=this._input_style[e];break;case"letterSpacing":t.letterSpacing=parseFloat(this._input_style.letterSpacing);break;case"textAlign":t.align=this._input_style.textAlign}return this._multiline&&(t.lineHeight=parseFloat(t.fontSize||"0"),t.wordWrap=!0,t.wordWrapWidth=this._getDOMInputBounds().width),0===this._dom_input.value.length&&(t.fill=this._placeholderColor),t}_deriveSurrogatePadding(){const t=this._input_style.textIndent?parseFloat(this._input_style.textIndent):0;if(this._input_style.padding&&this._input_style.padding.length>0){const e=this._input_style.padding.trim().split(" ");if(1==e.length){const i=parseFloat(e[0]);return[i,i,i,i+t]}if(2==e.length){const i=parseFloat(e[0]),s=parseFloat(e[1]);return[i,s,i,s+t]}if(4==e.length){const i=e.map((t=>parseFloat(t)));return i[3]+=t,i}}return[0,0,0,t]}_deriveSurrogateText(){return 0===this._dom_input.value.length?this._placeholder:"password"===this._dom_input.type?"•".repeat(this._dom_input.value.length):this._dom_input.value}_updateFontMetrics(){const t=this._deriveSurrogateStyle(),e=t.toFontString?t.toFontString():t.font||"";this._font_metrics=h.TextMetrics.measureFont(e)}_buildBoxCache(){this._destroyBoxCache();const t=["DEFAULT","FOCUSED","DISABLED"],e=this._getDOMInputBounds();for(const i of t)this._box_generator&&(this._box_cache[i]=this._box_generator(e.width,e.height,i));this._previous.input_bounds=e}_destroyBoxCache(){var t;this._box&&(this.removeChild(this._box),this._box=null);for(const e in this._box_cache)null===(t=this._box_cache[e])||void 0===t||t.destroy(),this._box_cache[e]=null,delete this._box_cache[e]}_hasFocus(){return document.activeElement===this._dom_input}_setDOMInputVisible(t){this._dom_input.style.display=t?"block":"none"}_getCanvasBounds(){const t=this._last_renderer.view.getBoundingClientRect(),e={top:t.top,left:t.left,width:t.width,height:t.height};return e.left+=window.scrollX,e.top+=window.scrollY,e}_getDOMInputBounds(){let t=!1;this._dom_added||(document.body.appendChild(this._dom_input),t=!0);const e=this._dom_input.style.transform,i=this._dom_input.style.display;this._dom_input.style.transform="",this._dom_input.style.display="block";const s=this._dom_input.getBoundingClientRect();return this._dom_input.style.transform=e,this._dom_input.style.display=i,t&&document.body.removeChild(this._dom_input),s}_getDOMRelativeWorldTransform(){const t=this._last_renderer.view.getBoundingClientRect(),e=this.worldTransform.clone();return e.scale(this._resolution||1,this._resolution||1),e.scale(t.width/this._last_renderer.width,t.height/this._last_renderer.height),e}_pixiMatrixToCSS(t){return"matrix("+[t.a,t.b,t.c,t.d,t.tx,t.ty].join(",")+")"}_comparePixiMatrices(t,e){return!(!t||!e)&&(t.a==e.a&&t.b==e.b&&t.c==e.c&&t.d==e.d&&t.tx==e.tx&&t.ty==e.ty)}_compareClientRects(t,e){return!(!t||!e)&&(t.left==e.left&&t.top==e.top&&t.width==e.width&&t.height==e.height)}}class C extends u{constructor(t){super(),this.props=t.props,this.textInput=new w(this.props);for(let t in this.props.input){let e=this.props.input[t];void 0!==e&&this.textInput.setInputStyle(t,e)}this.textInput.updateBox(this.props.box.default,"DEFAULT"),this.textInput.updateBox(this.props.box.focused,"FOCUSED"),this.textInput.updateBox(this.props.box.disabled,"DISABLED"),this.addChild(this.textInput)}}var T=o(381),B=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class L{constructor(t,e){this.spineData=t,this.assetBasePath=e}load(t){return B(this,void 0,void 0,(function*(){let e=this.spineData,i=this.assetBasePath,s=(e,i,s,n)=>{let r=null;(4===n||3===n)&&(r=new T.Spine(s)),r.name=i.name,i.skin&&(r.skeleton.setSkinByName(i.skin),r.skeleton.setSlotsToSetupPose()),t(r)};if(e.spineAtlas&&""!==e.spineAtlas)h.Assets.load({alias:e.name,src:i+e.spineJson,data:{metadata:{spineAtlasFile:i+e.spineAtlas}}}).then((t=>{let i=h.Assets.get(e.name).spineData;s(0,e,i,4)}));else if(e.pngFiles&&e.pngFiles.length){const t=h.Texture.EMPTY,n={},r=[];let o=e.name||"spine";for(const t of e.pngFiles)r.push(new Promise(((e,s)=>{const r=h.Texture.from(i+t);if(r.baseTexture.valid){let i=this.getFileNameWithoutExtension(t);o=i,n[i]=r,e(r)}else r.baseTexture.once("loaded",(()=>{n[this.getFileNameWithoutExtension(t)]=r,e(r)})),r.baseTexture.once("error",(e=>s(new Error(`Failed to load texture ${t}: ${e}`))))})));yield Promise.all(r);let a=i+e.spineJson.substring(0,e.spineJson.lastIndexOf("/")),l=a.substring(a.lastIndexOf("/")+1),d=this.getFileNameWithoutExtension(e.spineJson);if(l!==d)return void alert(`Spine JSON file "${e.spineJson}" should be in a folder named "${d}".`);const u=yield(yield fetch(i+e.spineJson)).json();let c=u.skeleton?u.skeleton.spine:null,p=3,g=null;c&&c.startsWith("4.")?(p=4,g=new T.TextureAtlas):g=new T.TextureAtlas,g.addTextureHash(n,!0);let _="";for(const e in u.skins){const i=u.skins[e];if(i.attachments)for(const e in i.attachments){const s=i.attachments[e];for(const e in s)if(n[e])g.addTexture(e,n[e]);else{g.addTexture(e,t),n[e]=t;let i=e;console.warn(i+" not found in loaded textures."),-1===_.indexOf(i)&&(_+=i,_+=", ")}}}for(const t in n){const e=t.match(/^(.*?)(\d+)$/);if(e){const i=e[1];0!==parseInt(e[2],10)||g.regions.some((t=>t.name===i))||(g.addTexture(i,n[t]),console.warn(`Aliased base region "${i}" -> "${t}"`))}}let b,m=null,f=null;3===p&&(m=new T.AtlasAttachmentLoader(g),f=new T.SkeletonJson(m),b=f.readSkeletonData(u),s(n[o],e,b,3)),4===p&&(m=new T.AtlasAttachmentLoader(g),f=new T.SkeletonJson(m),b=f.readSkeletonData(u),s(n[o],e,b,4))}}))}getFileNameWithoutExtension(t){const e=t.lastIndexOf("/"),i=e>=0?t.substring(e+1):t,s=i.lastIndexOf(".");return s>=0?i.substring(0,s):i}}var k=function(t,e,i,s){return new(i||(i=Promise))((function(n,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class P{get sceneStage(){return this._sceneStage}constructor(t){this.assetBasePath="",this.scene=null,this._sceneStage=new u,this.resizeMap=new Map,this.orientation="portrait",this.sceneName=null,this.sceneId=t,this.setOrientation(),P.Map.set(t,this)}setOrientation(){this.orientation=window.innerWidth>window.innerHeight?"landscape":"portrait"}static getSceneById(t){return P.Map.get(t)}loadStage(t){this.resize(window.innerWidth,window.innerHeight);let e=this.data.stage.children;if(e)for(let t=0;t<e.length;t++){let i=e[t],s=i.name,n=this.spawn(s);n&&(n.setInstanceData(i,this.orientation),this.addToResizeMap(n),this._sceneStage.addChild(n),this._sceneStage[n.name]=n)}t.addChild(this._sceneStage),this.resize(window.innerWidth,window.innerHeight)}addToResizeMap(t){this.resizeMap.set(t,!0)}removeFromResizeMap(t){this.resizeMap.delete(t)}getInnerDimensions(){this.data&&this.data.resolution;let t=this.data.resolution.x,e=this.data.resolution.y;return"portrait"===this.orientation&&(t=this.data.resolution.y,e=this.data.resolution.x),{width:t,height:e}}resize(t,e){if(this.data&&this.data.resolution){this.setOrientation();let i=this.data.resolution.x,s=this.data.resolution.y;"portrait"===this.orientation&&(i=this.data.resolution.y,s=this.data.resolution.x);const n=t/i,r=e/s,o=Math.min(n,r);this._sceneStage.scale.x=o,this._sceneStage.scale.y=o,this._sceneStage.x=(t-i*o)/2,this._sceneStage.y=(e-s*o)/2;for(const[i,s]of this.resizeMap)i.resize(t,e,this.orientation)}}load(t,e){return k(this,void 0,void 0,(function*(){this.assetBasePath=t;let i=t+"placements.json?rnd="+Math.random();fetch(i).then((t=>{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return t.json()})).then((i=>{this.loadAssets(t,i,e)})).catch((t=>{}))}))}destroy(){return k(this,void 0,void 0,(function*(){var t;const e=this.scene;if(e){yield e.parse();for(const t in e.textures)e.textures[t].destroy();null===(t=e.baseTexture)||void 0===t||t.destroy()}yield h.Assets.unload(this.sceneName)}))}loadAssets(t,e,i){return k(this,void 0,void 0,(function*(){let s=t+"ta.json?rnd="+Math.random(),n=e.atlas;if(null==n&&(n=!0),n)try{this.scene=yield h.Assets.load(s)}catch(t){console.error("Error loading spritesheet:",t)}else{let i=this.createImagesObject(t,e);this.scene=yield h.Assets.load(i),this.scene.textures=this.scene}if(this.sceneName=s,0==e.fonts.length)return this.initScene(e),void i();for(let s=0;s<e.fonts.length;s++){let n=e.fonts[s];fetch(t+n+".fnt").then((t=>t.text())).then((t=>{new h.BitmapFontData;h.BitmapFont.install(t,new h.Texture(this.scene.baseTexture)),s===e.fonts.length-1&&(this.initScene(e),i())})).catch((t=>console.error("Error loading .fnt:",t)))}}))}createFrame(t){let e=new h.Sprite(this.scene.textures[t]);return e}createImagesObject(t,e){let i=[],s={},n=e.templates;for(let e in n){let r=n[e].children;for(let e in r){let n=r[e];if("img"==n.type||"9slice"==n.type){let e=n;if(!s[e.name]){s[e.name]=!0;let n=e.name.endsWith("_9S")?e.name.slice(0,-3):e.name;n=n.endsWith("_IMG")?n.slice(0,-4):n,i.push({alias:n,src:t+e.filePath})}}}}return i}getNumOfFrames(t){let e=0;var i=this.scene.data;for(const s in i)-1!==s.indexOf(t)&&e++;return e}createMovieClip(t){const e=[],i=this.getNumOfFrames(t);for(let s=0;s<i;s++){const i=t+"00"+(s<10?"0"+s:s);e.push(h.Texture.from(i))}const s=new h.AnimatedSprite(e);return s.animationSpeed=1,s.loop=!1,s.name=t,s}initScene(t){this.data=t}getChildrenFrames(t){var e={},i=this.data.templates,s=this.data.animTracks,n=i[t];if(n&&n.children)for(var r=0;r<n.children.length;r++){var o=n.children[r].instanceName,a=o+"_"+t;s[a]&&(e[o]=s[a])}return e}static getAssetType(t){return this.assetTypes.has(t)?this.assetTypes.get(t):null}static isAssetType(t){return this.assetTypes.has(t)}spawn(t){var e=this.data.templates[t];if(e){var i,s=this.getChildrenFrames(t);return Object.keys(s).length>0?(i=new f,this.createAsset(i,e),i.setFrames(s),this.data.cuePoints&&this.data.cuePoints[t]&&i.setCuePoints(this.data.cuePoints[t]),i.gotoAndStop(0)):(i=new(P.getAssetType(e.type)||u),this.createAsset(i,e),i.init()),i}}getAllAssets(t,e){for(const i in t)"type"===i&&"asset"===t[i]&&(e[t.name]=t),t[i]instanceof Object&&this.getAllAssets(t[i],e);return e}degreesToRadians(t){return t*Math.PI/180}createAsset(t,e){return k(this,void 0,void 0,(function*(){for(var i=0;i<e.children.length;i++){var s,n=e.children[i],r=n.name,o=n.type;if("inputField"==o){(s=new C(n)).name=r,t[r]=s,t.addChild(s),this.applyFilters(n,s)}if("bmpTextField"==o||"textField"==o){let e=n;if(h.BitmapFont.available[e.fontName]){const i=new h.BitmapText(e.text||"",{fontName:e.fontName,fontSize:e.size,letterSpacing:e.letterSpacing||0});i.name=r,t[r]=i,t.addChild(i),i.x=e.x,i.y=e.y,this.applyFilters(n,i)}else{const i=new h.Text(e.text+"",{fontFamily:e.fontName,fontSize:e.size,fill:e.color,align:"center"});void 0!==e.textAnchorX&&void 0!==e.textAnchorY&&i.anchor.set(e.textAnchorX,e.textAnchorY),void 0!==e.pivotX&&void 0!==e.pivotY&&i.pivot.set(e.pivotX,e.pivotY),e.size&&(i.style.fontSize=e.size),e.color&&(i.style.fill=e.color),e.align&&(i.style.align=e.align),e.stroke&&(i.style.stroke=e.stroke),e.strokeThickness&&(i.style.strokeThickness=e.strokeThickness),e.wordWrap&&(i.style.wordWrap=e.wordWrap),e.wordWrapWidth&&(i.style.wordWrapWidth=e.wordWrapWidth),e.breakWords&&(i.style.breakWords=e.breakWords),e.leading&&(i.style.leading=e.leading),e.letterSpacing&&(i.style.letterSpacing=e.letterSpacing),e.padding&&(i.style.padding=e.padding),e.fontWeight&&(i.style.fontWeight=e.fontWeight),i.name=r,i.x=e.x,i.y=e.y,t[r]=i,t.addChild(i),this.applyFilters(n,i)}}if("img"==o){let e=n,i=e.width,s=e.height,o=e.x||0,h=e.y||0,d=e.pivotX||0,u=e.pivotY||0;var a=r;a=a.endsWith("_IMG")?a.slice(0,-4):a;var l=this.createFrame(a);if(!l)return;l.name=r,t[a]=l,t.addChild(l),l.x=o,l.y=h,l.width=i,l.height=s,l.pivot.set(d,u)}if("9slice"==o){let e=n,i=(e.width,e.height,e.x||0),s=e.y||0,o=e.pivotX||0,a=e.pivotY||0,h=r;h=h.endsWith("_9S")?h.slice(0,-3):h;var c=new d(this.scene.textures[h],e,this.orientation);if(!c)return;c.name=r,t[h]=c,t.addChild(c),this.addToResizeMap(c),c.x=i,c.y=s,c.pivot.set(o,a)}if(P.isAssetType(o)){var p=n,g=this.getChildrenFrames(n.name);if(Object.keys(g).length>0?((s=new f).setFrames(g),this.data.cuePoints&&this.data.cuePoints[n.name]&&s.setCuePoints(this.data.cuePoints[n.name])):s=new(P.getAssetType(o)||u),s.name=p.instanceName,!s.name)return;t[s.name]=s,this.applyFilters(n,s),s.setInstanceData(p,this.orientation),t.addChild(s),this.addToResizeMap(s)}if("particle"==o){let e=this.assetBasePath;e.endsWith("/")||(e+="/");let i=n,s=e+i.jsonPath+`?t=${Date.now()}`,r=e+i.pngPaths+`?t=${Date.now()}`;h.Assets.load(r).then((e=>{h.Assets.load(s).then((i=>{t.loadParticle(i,e,i.name)})).catch((t=>{console.error("Failed to load particle data:",t)}))}))}if("spine"==o){let e=this.assetBasePath;e.endsWith("/")||(e+="/"),new L(n,e).load((e=>{e&&t.addChild(e)}))}var _=this.data.templates[n.name];_&&_.children&&(s?this.createAsset(s,_):this.createAsset(t,_)),null==s||s.init()}}))}applyFilters(t,e){if(t.filters)for(var i in t.filters){let s=t.filters[i];if("dropShadow"==s.type){let t=new _.DropShadowFilter;t.alpha=s.alpha,t.blur=s.blur,t.color=s.color,t.distance=s.distance,t.resolution=s.resolution,t.rotation=s.rotation,e.filters||(e.filters=[]),e.filters.push(t)}}}createBitmapTextFromXML(t,e,i,s,n){return k(this,void 0,void 0,(function*(){const e=yield fetch(t);if(!e.ok)throw new Error(`Failed to fetch XML font data: ${e.statusText}`);const s=yield e.text(),r=(new DOMParser).parseFromString(s,"text/xml"),o=r.querySelector("page");if(!o)throw new Error("Page element not found in XML");const a=o.getAttribute("file");if(!a)throw new Error("Page file attribute not found in XML");var l="./../assets/"+a;return this.loadTexture(l).then((t=>{h.BitmapFont.install(r,t),h.BitmapFont.available[i]&&n()})).catch((t=>{console.error("Error loading texture:",t)})),null}))}loadTexture(t){return new Promise(((e,i)=>{const s=h.Texture.from(t);s.on("update",(()=>{s.valid?e(s):i(new Error("Failed to load texture."))}))}))}}P.assetTypes=new Map([["btn",p],["asset",u],["state",v],["toggle",x],["slider",y],["scrollBar",S],["fullScreen",u]]),P.Map=new Map;class A{static push(t){this.stack[this.top]=t,this.top++,this.stackSize++}static pop(){return this.stackSize>0?(this.top--,this.stackSize--,this.stack[this.top]):null}static peek(){return this.stackSize>0?this.stack[this.top-1]:null}static getStackSize(){return this.stackSize}static clear(){this.stack=[],this.stackSize=0,this.top=0}static spawn(t){for(let e=this.stack.length-1;e>=0;e--){let i=this.stack[e].spawn(t);if(i)return i}}static resize(t,e){for(let i=this.stack.length-1;i>=0;i--){this.stack[i].resize(t,e)}}}return A.stack=[],A.stackSize=0,A.top=0,a})()));